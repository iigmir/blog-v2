import{IDateComponentElement}from"./i-date.min.js";class ArticleTagsApp{constructor(){}id="";set_id(){const e=location.pathname.split("articles/")[1];e&&(this.id=e.split(".")[0])}responsed_source_data={};get data_api_path(){return location.host.includes("127.0.0.1")?"/docs/api/data.json":`https://iigmir.serv00.net/api/blog-metadata/${this.id}`}get ajax_data(){return this.responsed_source_data.data}tags_data=[];get tags_api_path(){return location.host.includes("127.0.0.1")?"/docs/api/tags.json":"https://raw.githubusercontent.com/iigmir/blog-source/master/info-files/categories.json"}get matched_tags(){return[...(this.responsed_source_data.data??{category_id:[]}).category_id].map((e=>this.tags_data.find((t=>t.id===e))?.tag_name??null)).filter((e=>e))}request_api(){return new Promise(((e,t)=>{this.id||t("No ID given");Promise.all([fetch(this.tags_api_path).then((e=>e.json())),fetch(this.data_api_path).then((e=>e.json()))]).then((([t,a])=>{this.tags_data=t,this.responsed_source_data=a,e(this.responsed_source_data)})).catch((e=>{t(e)}))}))}}class ArticleTagsAppELement extends HTMLElement{tags_object=null;constructor(){super()}connectedCallback(){this.tags_object=new ArticleTagsApp}tagsapp_action(){this.tags_object.set_id(),this.tags_object.request_api().then((e=>{this.render_resolved_element()})).catch((e=>{console.error(e),this.render_rejected_element(e)}))}render_resolved_element(){const e=this.tags_object,t=this.attachShadow({mode:"open"}),a=document.createElement("footer");a.setAttribute("class","tags container");const s=document.createElement("p");s.textContent="Tags: ";const n=document.createElement("ul");n.classList.add("badges"),n.classList.add("-round");e.matched_tags.map((e=>{const t=document.createElement("li");return t.classList.add("item"),t.classList.add("click-icon"),t.textContent=e,t})).forEach((e=>n.appendChild(e)));const d=document.createElement("link");d.setAttribute("rel","stylesheet"),d.setAttribute("href","../css/new-framework.min.css");const i=document.createElement("span");i.textContent=" ",t.appendChild(d),t.appendChild(a),a.appendChild(this.generate_date_component("Created: ","date -created",e.ajax_data.created_at)),a.appendChild(i),a.appendChild(this.generate_date_component("Updated: ","date -updated",e.ajax_data.updated_at)),a.appendChild(s),a.appendChild(n)}render_rejected_element(e=""){const t=this.attachShadow({mode:"open"}),a=document.createElement("footer");a.setAttribute("class","tags container");const s=document.createElement("link");s.setAttribute("rel","stylesheet"),s.setAttribute("href","../css/new-framework.min.css");const n=document.createElement("span");n.textContent="Oh-oh. Something's up. :-(",n.dataset.errorMessage=e,t.appendChild(s),t.appendChild(a),a.appendChild(n)}generate_date_component(e="",t="",a=""){const s=document.createElement("i-date");return s.dataset.title=e,s.dataset.date=a,s.dataset.classes=t,s.dataset.timezone="Asia/Taipei",s}}function main(){customElements.define("article-tags-app",ArticleTagsAppELement),customElements.define("i-date",IDateComponentElement)}main();