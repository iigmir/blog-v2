import{IDateComponentElement}from"./i-date.min.js";class ArticleTagsApp{constructor(){}id="";set_id(){const t=location.pathname.split("articles/")[1];t&&(this.id=t.split(".")[0])}responsed_source_data={};get data_api_path(){return"https://raw.githubusercontent.com/iigmir/blog-source/master/info-files/articles.json"}get ajax_data(){return this.responsed_source_data.data}tags_data=[];get tags_api_path(){return location.host.includes("127.0.0.1")?"/docs/api/tags.json":"https://raw.githubusercontent.com/iigmir/blog-source/master/info-files/categories.json"}get matched_tags(){return[...(this.responsed_source_data.data??{category_id:[]}).category_id].map((t=>this.tags_data.find((e=>e.id===t))?.tag_name??null)).filter((t=>t))}request_api(){return new Promise(((t,e)=>{this.id||e("No ID given");Promise.all([fetch(this.tags_api_path).then((t=>t.json())),fetch(this.data_api_path).then((t=>t.json()))]).then((([e,a])=>{this.tags_data=e,this.responsed_source_data={data:a.filter((({id:t})=>t==this.id))[0]},t(this.responsed_source_data)})).catch((t=>{e(t)}))}))}}class ResolvedElements{constructor(t={matched_tags:[],ajax_data:{}}){this.ajax_data=t.ajax_data,this.matched_tags=t.matched_tags}get css_loader(){const t=document.createElement("link");return t.setAttribute("rel","stylesheet"),t.setAttribute("href","../css/new-framework.min.css"),t}get tags_list_dom(){const t=document.createElement("ul");return t.classList.add("badges"),t.classList.add("-round"),this.matched_tags.map((t=>{const e=document.createElement("li");return e.classList.add("item"),e.classList.add("click-icon"),e.textContent=t,e})).forEach((e=>t.appendChild(e))),t}get help_dom(){const t=document.createElement("p");return t.textContent="Tags: ",t}generate_date_component(t="",e="",a=""){const s=document.createElement("i-date");return s.dataset.title=t,s.dataset.date=a,s.dataset.classes=e,s.dataset.timezone="Asia/Taipei",s}get date_doms(){return{created:this.generate_date_component("Created: ","date -created",this.ajax_data.created_at),updated:this.generate_date_component("Updated: ","date -updated",this.ajax_data.updated_at)}}get gap_dom(){const t=document.createElement("span");return t.textContent=" ",t}}class ArticleTagsAppELement extends HTMLElement{tags_object=null;constructor(){super()}connectedCallback(){this.tags_object=new ArticleTagsApp,this.tagsapp_action()}tagsapp_action(){this.tags_object.set_id(),this.tags_object.request_api().then((t=>{this.render_resolved_element()})).catch((t=>{console.error(t),this.render_rejected_element(t)}))}render_resolved_element(){const t=new ResolvedElements(this.tags_object),e=this.attachShadow({mode:"open"}),a=document.createElement("footer");a.setAttribute("class","tags container"),a.appendChild(t.date_doms.created),a.appendChild(t.gap_dom),a.appendChild(t.date_doms.updated),a.appendChild(t.help_dom),a.appendChild(t.tags_list_dom),e.appendChild(t.css_loader),e.appendChild(a)}render_rejected_element(t=""){const e=this.attachShadow({mode:"open"}),a=document.createElement("footer");a.setAttribute("class","tags container");const s=document.createElement("link");s.setAttribute("rel","stylesheet"),s.setAttribute("href","../css/new-framework.min.css");const n=document.createElement("span");n.textContent="Oh-oh. Something's up. :-(",n.dataset.errorMessage=t,e.appendChild(s),e.appendChild(a),a.appendChild(n)}}function main(){customElements.define("article-tags-app",ArticleTagsAppELement),customElements.define("i-date",IDateComponentElement)}main();